version: "3.1"

stories:

- story: Help genres explicit
  steps:
  - intent: help_genres
  - slot_was_set:
    - movie_or_tv: null
  - action: utter_disambigua_movie_tv
  - action: movie_tv_form
  - action: action_genres_available
  - slot_was_set:
      - genres_available
  - action: utter_genres

- story: Help genres implicit
  steps:
  - intent: help_genres
  - slot_was_set:
    - movie_or_tv
  - action: action_genres_available
  - slot_was_set:
      - genres_available
  - action: utter_genres

- story: genre implicit
  steps:
  - intent: ask_movie
  - slot_was_set:
    - movie_or_tv: null
    - genre
  - checkpoint: checkpoint_genre_gotten

- story: genre implicit movie
  steps:
  - checkpoint: checkpoint_genre_gotten
  - action: utter_disambigua_movie_tv
  - intent: ask_movie
  - slot_was_set:
    - movie_or_tv
  - checkpoint: checkpoint_movie_tv_genre_gotten

- story: movie or tv implicit
  steps:
  - intent: ask_movie
  - slot_was_set:
    - movie_or_tv
    - genre
  - checkpoint: checkpoint_movie_tv_genre_gotten

- story: movie or tv disambigua implicit movie or tv
  steps:
  - intent: ask_movie
  - slot_was_set:
    - movie_or_tv
  - checkpoint: checkpoint_movie_tv_gotten

- story: movie or tv disambigua explicit
  steps:
  - intent: ask_movie
  - slot_was_set:
    - movie_or_tv: null
    - genre: null
  - action: utter_disambigua_movie_tv
  - action: movie_tv_form
  - checkpoint: checkpoint_movie_tv_gotten

- story: movie recommendation genre implicit
  steps:
  - checkpoint: checkpoint_movie_tv_gotten
  - action: utter_disambigua_discovery
  - intent: genre
  - slot_was_set:
    - genre
  - checkpoint: checkpoint_movie_tv_genre_gotten


- story: movie recommendation genre explicit
  steps:
  - checkpoint: checkpoint_movie_tv_gotten
  - action: utter_disambigua_discovery
  - intent: genre
  - slot_was_set:
    - genre: null
  - action: utter_intent_specification
  - action: genre_form
  - checkpoint: checkpoint_movie_tv_genre_gotten

- story:  movie recommendation popular
  steps:
  - checkpoint: checkpoint_movie_tv_gotten
  - action: utter_disambigua_discovery
  - intent: popular
  - checkpoint: checkpoint_discovery_popular


- story: movie discovery genre validation
  steps:
  - checkpoint: checkpoint_movie_tv_genre_gotten
  - action: custom_genre_validation
  - slot_was_set:
    - movie_or_tv
    - genre
    - genre_validated: true
    - suggested_genre: null
  - checkpoint: checkpoint_discovery

- story: movie discovery genre validation
  steps:
  - checkpoint: checkpoint_movie_tv_genre_gotten
  - action: custom_genre_validation
  - slot_was_set:
    - movie_or_tv
    - genre
    - genre_validated: false
    - suggested_genre: null
  - action: action_genres_available
  - slot_was_set:
    - genres_available
  - action: utter_genre_disambigua
  - intent: genre
  - slot_was_set:
    - genre
  - checkpoint: checkpoint_movie_tv_genre_gotten

- story: movie discovery genre validation
  steps:
  - checkpoint: checkpoint_movie_tv_genre_gotten
  - action: custom_genre_validation
  - slot_was_set:
    - movie_or_tv
    - genre
    - genre_validated: false
    - suggested_genre
  - action: action_genres_available
  - slot_was_set:
    - genres_available
  - checkpoint: checkpoint_genre_suggestion

- story: movie discovery genre validation affirm
  steps:
  - checkpoint: checkpoint_genre_suggestion
  - action: utter_genre_disambigua_suggestion
  - intent: affirm
  - action: custom_genre_validation_confirmation
  - slot_was_set:
    - movie_or_tv
    - genre
    - genre_validated: true
    - suggested_genre: null
  - checkpoint: checkpoint_discovery

- story: movie discovery genre validation deny
  steps:
  - checkpoint: checkpoint_genre_suggestion
  - action: utter_genre_disambigua_suggestion
  - intent: deny
  - action: utter_intent_specification
  - intent: genre
  - slot_was_set:
    - genre
  - checkpoint: checkpoint_movie_tv_genre_gotten

- story: movie discovery genre validation deny check
  steps:
  - checkpoint: checkpoint_genre_suggestion
  - action: utter_genre_disambigua_suggestion
  - intent: genre
  - slot_was_set:
    - genre
  - checkpoint: checkpoint_movie_tv_genre_gotten
# - story: movie discovery checkpoint (final)
#   steps:
#   - checkpoint: checkpoint_discovery
#   - action: action_discover_movie
#   - slot_was_set:
#     - top_names
#   - action: utter_discover_genre_movie
#   - action: action_restart
- story: movie discovery checkpoint (final)
  steps:
  - checkpoint: checkpoint_discovery
  - action: action_discover_movie
  - slot_was_set:
    - top_names
  - action: utter_discover_genre_movie
  - action: action_restart

- story: movie discovery checkpoint popular (final)
  steps:
  - checkpoint: checkpoint_discovery_popular
  - action: custom_genre_validation
  - slot_was_set:
    - movie_or_tv
    - genre: null
    - genre_validated: true
  - action: action_discover_movie
  - slot_was_set:
    - top_names
  - action: utter_discover_movie
  - action: action_restart
# - story: movie discovery checkpoint (final)
#   steps:
#   - slot_was_set:
#     - genre: null
#   - checkpoint: checkpoint_discovery
#   - action: action_discover_movie
#   - slot_was_set:
#     - top_names
#   - action: utter_discover_movie
#   - action: action_restart

# - story: movie lookup implicit
#   steps:
#   - intent: greet
#   - action: utter_greet
#   - intent: lookup_movie
#   - slot_was_set:
#     - movie
#   - action: action_lookup_movie

# - story: movie lookup explicit
#   steps:
#   - intent: greet
#   - action: utter_greet
#   - intent: lookup_movie
#   - slot_was_set:
#     - movie: null
#   - action: utter_lookup_specification
#   - action: lookup_form
#   - action: action_lookup_movie

# # interactive movie with netflix checkpoint
# - story: movie interaction
#   steps:
#   - checkpoint: checkpoint_movie_gotten
#   - intent: ask_availability_movie
#   - slot_was_set:
#     - movie
#   - action: action_get_availability_movie
#   - action: utter_availability_movie

  
# TODO validation of genre slot 
# double take if genre is not valid ?
# branch genre slot filled or not √
# one does not know what available genres are there √
# check correctness of parsed genres
# fallback rule √
# fallback story
# open netflix
# test and add unhappy paths
# explicit 0 result
# caps the validated slot √
# propose new form if confidence is low
# what if a user sets genre before movie or tv?
# what may happen in validation of slots


# with movie_or_tv set

# - slot is not present in either movie or tv show.
# - prompt again with possibilities

# - slot is present with high confidence in the opposite slot
# - do you want to change?

    